<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="description" content="" />
        <link rel="icon" href="/favicon/icon_x48.png" />
        <meta name="theme-color" content="#021312"/>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="description" content="The Personal Website of James Bennion-Pedley">
        <link rel="manifest" href="/manifest.json" />

        <!-- Description -->
        <meta name="description" content="BOJIT Projects, tutorials and ramblings.">
        <meta name="keywords" content="BOJIT,Github,James Bennion-Pedley,engineering,
            programming,Raspberry Pi,Linux,C++,MagicQ,lighting,theatre,electronics">

        <!-- Author -->
        <meta name="author" content="James Bennion-Pedley">

        <meta http-equiv="content-security-policy" content=""><title>VCS (PlatformIO Advanced Scripting)</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-GDC4Q081QM" data-svelte="svelte-2zfw7e"></script><script data-svelte="svelte-2zfw7e">window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-GDC4Q081QM');
    </script>
	<link rel="stylesheet" href="/_app/immutable/assets/pages/__layout.svelte-e9d28631.css">
	<link rel="stylesheet" href="/_app/immutable/assets/Notification-a449c76c.css">
	<link rel="stylesheet" href="/_app/immutable/assets/IconButton-daa2eb6b.css">
	<link rel="stylesheet" href="/_app/immutable/assets/pages/__layout-post@default.svelte-a0f73b82.css">
	<link rel="stylesheet" href="/_app/immutable/assets/Content-2c6882cc.css">
	<link rel="stylesheet" href="/_app/immutable/assets/Header-99197cc5.css">
	<link rel="stylesheet" href="/_app/immutable/assets/ThemeSelector-9f4cf020.css">
	<link rel="stylesheet" href="/_app/immutable/assets/NavButton-0091e670.css">
	<link rel="stylesheet" href="/_app/immutable/assets/CopyButton.svelte_svelte_type_style_lang-d20dba86.css">
	<link rel="modulepreload" href="/_app/immutable/start-32254f0a.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/index-5dfa2933.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/index-edf86401.js">
	<link rel="modulepreload" href="/_app/immutable/pages/__layout.svelte-f5a1ebc7.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/ripple-59eba3d5.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/Notification-7f4998ec.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/prism-a46989fb.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/IconButton-5dfdb110.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/Link-92225e0d.js">
	<link rel="modulepreload" href="/_app/immutable/pages/__layout-post@default.svelte-54893499.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/Content-e6d7cbfb.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/Header-bb337661.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/ThemeSelector-a45fb36e.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/NavButton-03483166.js">
	<link rel="modulepreload" href="/_app/immutable/pages/tutorials/__layout@post.svelte-aea41c22.js">
	<link rel="modulepreload" href="/_app/immutable/pages/tutorials/VCS.svelte.md-dd072023.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/prism-c-30ee303a.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/prism-bash-4c44f9e3.js">
			<script>
		if ('serviceWorker' in navigator) {
			addEventListener('load', () => {
				navigator.serviceWorker.register('/service-worker.js');
			});
		}
	</script>
    </head>
    <body>
        <div>






<div class="splash svelte-9egd74" style="background-color: #303233"><svg class="circular svelte-1xkiyez" style="width: 70px; height: 70px;"><circle class="path stroke-primary svelte-1xkiyez" cx="35" cy="35" fill="none" r="21" stroke-width="3" stroke-miterlimit="10" style=" stroke: #7783a8; "></circle></svg></div>
<div class="app svelte-1ikovc4"><main class="svelte-17szv2b">





<header class="svelte-1juccls"><div class="header-action svelte-1juccls">




<button  class="rounded overflow-hidden svelte-eemtoe hoverable" style="background-color: var(--color-background-dark-trans-light)" aria-label="Accessibility Label"><svg height="2em" color="var(--color-gray-900)" fill="currentColor" viewBox="0 0 512 512"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M368 128h80m-384 0h240m64 256h80m-384 0h240m-96-128h240m-384 0h80"></path><circle cx="336" cy="128" r="32" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></circle><circle cx="176" cy="256" r="32" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></circle><circle cx="336" cy="384" r="32" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></circle></svg></button>
        




<a href="/" target="" aria-label="Accessibility Label"><button  class="rounded overflow-hidden svelte-eemtoe hoverable" style="background-color: var(--color-background-dark-trans-light)" aria-label="Accessibility Label"><svg height="2em" color="var(--color-gray-900)" fill="currentColor" viewBox="0 0 512 512"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M80 212v236a16 16 0 0 0 16 16h96V328a24 24 0 0 1 24-24h80a24 24 0 0 1 24 24v136h96a16 16 0 0 0 16-16V212"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M480 256 266.89 52c-5-5.28-16.69-5.34-21.78 0L32 256m368-77V64h-48v69"></path></svg></button></a></div>
    <img src="https://cdn.bojit.org/img/general/header.JPG" alt="Page Header" class="svelte-1juccls">
</header>

<article class="svelte-1ss916v"><h1 class="svelte-njo12o">VCS (PlatformIO Advanced Scripting)</h1>
    <h3 class="svelte-njo12o"><b>16-04-2022</b></h3>
    <p><code>VCS</code> <em>(Version Control System)</em> is a simple script that works with the <code>PlatformIO</code> build system to add useful metadata to the output binaries of embedded projects. The exact workings of the tool are documented on <a href="https://github.com/BOJIT/VCS" rel="nofollow">GitHub</a>, so I won’t dive into detail here. This article focuses more on the internals of the library and some of the cool things you can do with the scripting engine.</p>
<p><img src="https://cdn.bojit.org/img/tiles/2022-04-16-VCS.PNG" alt="VCS Tile"></p>
<p>PlatformIO is built on <code>Python</code>. Any valid <code>Python</code> can be executed in the context of the build environment, and if you are somewhat familiar with the <code>SCons</code> build environment that <code>PlatformIO</code> uses, then you can pretty much mess with any part of the <code>C/C++</code> build process!</p>
<p>The <a href="https://docs.platformio.org/en/latest/scripting/index.html" rel="nofollow"><code>PlatformIO</code> docs</a> give a thorough breakdown of the <code>SCons</code> API, but it is quite light on real-life examples.</p>
<p>Below are a few examples of useful things that the PlatformIO scripting API can help you do:</p>
<h3>Automated Upstream Library Configuration</h3>
<p>The <code>SCons</code> build system allows the source and include paths to be edited programatically. I have used this in the past to configure libraries pulled directly from an upstream source. <code>FreeRTOS</code> is a good example of where this is useful. To use the library directly, you need to choose a target architecture <code>port.c</code> file, choose a memory management scheme, and configure some basic options.</p>
<p>In the scripting API you have access to all of your platform build variables, so it makes easy to configure these options automatically based on your target environment. An example of that could be:</p>
<div><div class="button svelte-11bnmlh"><button class=" px-4 uppercase text-sm font-medium relative overflow-hidden text-white duration-200 ease-in  bg-primary-500  hover:bg-primary-400   hover:shadow shadow  p-4 flex items-center select-none  rounded-full  rounded   lozenge  transparent  svelte-j1346v" iconColor="var(--color-gray-500)" lozenge transparent type="button"><i aria-hidden="true" class="material-icons icon text-xl select-none undefined duration-200 ease-in svelte-zzky5a" style="color: var(--color-gray-500);  ">content_copy</i>
    </button></div>
</div>
<pre class="language-python"><!-- HTML_TAG_START --><code class="language-python"><span class="token comment"># Get predefined C macro (could be defined by build system or .ini file)</span>
<span class="token keyword">for</span> item <span class="token keyword">in</span> env<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"CPPDEFINES"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token builtin">tuple</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> item<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'PORT_TYPE'</span><span class="token punctuation">:</span>
            port_type <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

<span class="token comment"># Configure source and include paths based on this macro</span>
env<span class="token punctuation">.</span>Append<span class="token punctuation">(</span>CPPPATH<span class="token operator">=</span><span class="token punctuation">[</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>realpath<span class="token punctuation">(</span><span class="token string">"FreeRTOS-Kernel/include"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
env<span class="token punctuation">.</span>Append<span class="token punctuation">(</span>CPPPATH<span class="token operator">=</span><span class="token punctuation">[</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>realpath<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">"FreeRTOS-Kernel/portable/GCC/"</span><span class="token punctuation">,</span> port_type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
env<span class="token punctuation">.</span>Replace<span class="token punctuation">(</span>SRC_FILTER<span class="token operator">=</span><span class="token punctuation">[</span>
        <span class="token string">"+&lt;FreeRTOS-Kernel/>"</span><span class="token punctuation">,</span>
        <span class="token string">"-&lt;FreeRTOS-Kernel/portable/>"</span><span class="token punctuation">,</span>
        <span class="token string">"+&lt;FreeRTOS-Kernel/portable/MemMang/heap_4.c>"</span><span class="token punctuation">,</span>
        os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">"+&lt;FreeRTOS-Kernel/portable/GCC/"</span><span class="token punctuation">,</span> port_type<span class="token punctuation">,</span> <span class="token string">">"</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span></code><!-- HTML_TAG_END --></pre>
<p>A more complete example of this behaviour is shown in my <code>PlatformIO-FreeRTOS</code> <a href="https://github.com/BOJIT/PlatformIO-FreeRTOS" rel="nofollow">library</a>.</p>
<h3>Tagged Version Fetching</h3>
<p>PlatformIO does have built-in support for fetching Git repositories, but this only works if that repository is in the default library format or contains a <code>library.json</code> file. With the advanced scripting engine you can fetch the library on-the-fly and modify it.</p>
<p>I have used the <code>GitPython</code> package in the past. It allows you to fetch and manage Git repositories programatically. Two functions I use extensively are:</p>
<div><div class="button svelte-11bnmlh"><button class=" px-4 uppercase text-sm font-medium relative overflow-hidden text-white duration-200 ease-in  bg-primary-500  hover:bg-primary-400   hover:shadow shadow  p-4 flex items-center select-none  rounded-full  rounded   lozenge  transparent  svelte-j1346v" iconColor="var(--color-gray-500)" lozenge transparent type="button"><i aria-hidden="true" class="material-icons icon text-xl select-none undefined duration-200 ease-in svelte-zzky5a" style="color: var(--color-gray-500);  ">content_copy</i>
    </button></div>
</div>
<pre class="language-python"><!-- HTML_TAG_START --><code class="language-python"><span class="token keyword">def</span> <span class="token function">getRemoteTags</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    g <span class="token operator">=</span> git<span class="token punctuation">.</span>cmd<span class="token punctuation">.</span>Git<span class="token punctuation">(</span><span class="token punctuation">)</span>
    blob <span class="token operator">=</span> g<span class="token punctuation">.</span>ls_remote<span class="token punctuation">(</span>url<span class="token punctuation">,</span> sort<span class="token operator">=</span><span class="token string">'-v:refname'</span><span class="token punctuation">,</span> tags<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> refs<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    entries <span class="token operator">=</span> blob<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'&#92;n'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>partition<span class="token punctuation">(</span><span class="token string">'refs/tags/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> entries<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">getLocalTag</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    g <span class="token operator">=</span> git<span class="token punctuation">.</span>Repo<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">(</span>tag <span class="token keyword">for</span> tag <span class="token keyword">in</span> g<span class="token punctuation">.</span>tags <span class="token keyword">if</span> tag<span class="token punctuation">.</span>commit <span class="token operator">==</span> g<span class="token punctuation">.</span>head<span class="token punctuation">.</span>commit<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">pass</span></code><!-- HTML_TAG_END --></pre>
<p>This is handy for some automated library work, but where it really shines is in a corporate environment. Many teams at work have trouble keeping certain build data/settings synchronised across projects. Adding a <code>lib-build.py</code> to our default project template effectively ‘forces’ team members to keep certain dependencies up to date!</p>
<h3>Asset Bundling</h3>
<p>Projects involving UI and IoT often involve assets that cannot be natively compiled by a C compiler. Examples include UI Images and FileSystem data for web servers. There exist <a href="https://lvgl.io/tools/imageconverter" rel="nofollow">tools</a> to do this sort of thing, but they are mostly web-based or use ancient scripting languages like <em>perl</em>. These assets are also tricky to incorporate into CI/CD toolchains, meaning <em>compiled</em> assets often just get left in source control. A nice alternative would be to have these assets treated as part of the compilation framework, similar to how web bundlers work.</p>
<h3>Certificate Management and Authentication</h3>
<p>IoT projects typically require API keys, certificates, MAC addresses and other product-specific information embedded in the firmware. In industry specialised tools exist to modify binaries when programming devices on a production line. This is impractical for most hobbyists, but for small production runs have a slightly more automated firmware build system is probably desirable.</p>
<h2>Tips and Tricks</h2>
<p>There are a few parts of the scripting API that initially caught me out.</p>
<p>The first of these is importing Third-Party <code>python</code> packages when in the build environment. Packages must be installed within PlatformIO’s own python virtual environment: this can be done from within the build script with the following snippet:</p>
<div><div class="button svelte-11bnmlh"><button class=" px-4 uppercase text-sm font-medium relative overflow-hidden text-white duration-200 ease-in  bg-primary-500  hover:bg-primary-400   hover:shadow shadow  p-4 flex items-center select-none  rounded-full  rounded   lozenge  transparent  svelte-j1346v" iconColor="var(--color-gray-500)" lozenge transparent type="button"><i aria-hidden="true" class="material-icons icon text-xl select-none undefined duration-200 ease-in svelte-zzky5a" style="color: var(--color-gray-500);  ">content_copy</i>
    </button></div>
</div>
<pre class="language-python"><!-- HTML_TAG_START --><code class="language-python"><span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token keyword">import</span> example
<span class="token keyword">except</span> ImportError<span class="token punctuation">:</span>
    env<span class="token punctuation">.</span>Execute<span class="token punctuation">(</span><span class="token string">"$PYTHONEXE -m pip install example"</span><span class="token punctuation">)</span>
    <span class="token keyword">import</span> example
</code><!-- HTML_TAG_END --></pre>
<p>The second ‘Gotcha’ is the understanding of build scope from within libraries.</p>
<p>When using scripting from the main <code>platformio.ini</code> file, we are modifying the build environment of our main codebase: Aside from build_flags these changes do not propogate down to our libraries. Likewise, when calling build scripts from within <code>library.json</code>, we are modifying the build environment of that library, not the whole project.</p>
<p>This can be a bit confusing when it comes to global config files. Projects such as <code>lwIP</code>, <code>freeRTOS</code> and <code>lvgl</code> use global config files that must be added to your project. However, by default, your project include paths are not passed to libraries when they are complied. A simple workaround is to use the scripting API to add the root include directory to your libary build:</p>
<div><div class="button svelte-11bnmlh"><button class=" px-4 uppercase text-sm font-medium relative overflow-hidden text-white duration-200 ease-in  bg-primary-500  hover:bg-primary-400   hover:shadow shadow  p-4 flex items-center select-none  rounded-full  rounded   lozenge  transparent  svelte-j1346v" iconColor="var(--color-gray-500)" lozenge transparent type="button"><i aria-hidden="true" class="material-icons icon text-xl select-none undefined duration-200 ease-in svelte-zzky5a" style="color: var(--color-gray-500);  ">content_copy</i>
    </button></div>
</div>
<pre class="language-python"><!-- HTML_TAG_START --><code class="language-python"><span class="token comment"># This script snippet works from any build context!</span>
env<span class="token punctuation">.</span>Append<span class="token punctuation">(</span>CPPPATH<span class="token operator">=</span>env<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"PROJECT_INCLUDE_DIR"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code><!-- HTML_TAG_END --></pre>
<p>The final tip is to run your builds using the <code>-v</code> <em>(verbose)</em> flag when writing scripts. Ultimately all <code>SCons</code> is doing is deciding what needs to be recompiled and passing the appropriate flags to <code>gcc</code>.</p>
<p>Anyway… I’ve got sidetracked… back to the library!</p>
<h2>VCS Usage</h2>
<p>The library doesn’t really require any interaction: all you need to do to activate it is add the library your <code>platformio.ini</code> file and the rest is handled automatically.</p>
<p>The library generates the following entry as a global C-struct</p>
<div><div class="button svelte-11bnmlh"><button class=" px-4 uppercase text-sm font-medium relative overflow-hidden text-white duration-200 ease-in  bg-primary-500  hover:bg-primary-400   hover:shadow shadow  p-4 flex items-center select-none  rounded-full  rounded   lozenge  transparent  svelte-j1346v" iconColor="var(--color-gray-500)" lozenge transparent type="button"><i aria-hidden="true" class="material-icons icon text-xl select-none undefined duration-200 ease-in svelte-zzky5a" style="color: var(--color-gray-500);  ">content_copy</i>
    </button></div>
</div>
<pre class="language-c"><!-- HTML_TAG_START --><code class="language-c"><span class="token keyword">const</span> <span class="token class-name">vcs_t</span> vcs <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">&#123;</span><span class="token number">0xFF</span><span class="token punctuation">,</span> <span class="token number">0xFE</span><span class="token punctuation">,</span> <span class="token number">0xFD</span><span class="token punctuation">,</span> <span class="token number">0xFC</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>   <span class="token comment">/* frame_start */</span>
    <span class="token number">1</span><span class="token punctuation">,</span>                          <span class="token comment">/* schema */</span>
    __VCS_COMPILE_TIME<span class="token punctuation">,</span>         <span class="token comment">/* compile_time */</span>
    __VCS_SHORT_HASH<span class="token punctuation">,</span>           <span class="token comment">/* short_hash */</span>
    __VCS_IS_DIRTY<span class="token punctuation">,</span>             <span class="token comment">/* is_dirty */</span>
    __VCS_TAG_DESCRIBE<span class="token punctuation">,</span>         <span class="token comment">/* tag_describe */</span>
    __VCS_LAST_AUTHOR<span class="token punctuation">,</span>          <span class="token comment">/* author */</span>
    <span class="token punctuation">&#123;</span><span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0x02</span><span class="token punctuation">,</span> <span class="token number">0x03</span><span class="token punctuation">,</span> <span class="token number">0x04</span><span class="token punctuation">&#125;</span>    <span class="token comment">/* frame_end */</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code><!-- HTML_TAG_END --></pre>
<p>An example output for a typical compilation may look something like this:</p>
<div><div class="button svelte-11bnmlh"><button class=" px-4 uppercase text-sm font-medium relative overflow-hidden text-white duration-200 ease-in  bg-primary-500  hover:bg-primary-400   hover:shadow shadow  p-4 flex items-center select-none  rounded-full  rounded   lozenge  transparent  svelte-j1346v" iconColor="var(--color-gray-500)" lozenge transparent type="button"><i aria-hidden="true" class="material-icons icon text-xl select-none undefined duration-200 ease-in svelte-zzky5a" style="color: var(--color-gray-500);  ">content_copy</i>
    </button></div>
</div>
<pre class="language-json"><!-- HTML_TAG_START --><code class="language-json"><span class="token punctuation">&#123;</span>
    <span class="token property">"schema"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"compile_time"</span><span class="token operator">:</span> <span class="token string">"2022-01-13T12:03Z"</span><span class="token punctuation">,</span>
    <span class="token property">"short_hash"</span><span class="token operator">:</span> <span class="token string">"293b1c5"</span><span class="token punctuation">,</span>
    <span class="token property">"is_dirty"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"tag_describe"</span><span class="token operator">:</span> <span class="token string">"1.0.0-2-g293b1c5"</span><span class="token punctuation">,</span>
    <span class="token property">"last_author"</span><span class="token operator">:</span> <span class="token string">"James Bennion-Pedley"</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre>
<p>You can access the <code>vcs</code> struct anywhere you include the header, so the output can be used in your program.</p>
<h2>Checking Versions</h2>
<p>Looking through binaries for an embedded bit of metadata is tedious. Ideally I would have liked to place the metadata at the start or end of the firmware binary, but doing this would involve programatically editing the linker file, which just seems like asking for trouble.</p>
<p>Instead, the library includes a simple python script that searches for a ‘magic pattern’ that signifies the fixed-size metadata block.</p>
<p>simply get your binary file, download the script and run the following python command:</p>
<div><div class="button svelte-11bnmlh"><button class=" px-4 uppercase text-sm font-medium relative overflow-hidden text-white duration-200 ease-in  bg-primary-500  hover:bg-primary-400   hover:shadow shadow  p-4 flex items-center select-none  rounded-full  rounded   lozenge  transparent  svelte-j1346v" iconColor="var(--color-gray-500)" lozenge transparent type="button"><i aria-hidden="true" class="material-icons icon text-xl select-none undefined duration-200 ease-in svelte-zzky5a" style="color: var(--color-gray-500);  ">content_copy</i>
    </button></div>
</div>
<pre class="language-bash"><!-- HTML_TAG_START --><code class="language-bash">$ get_vcs.py ./<span class="token environment constant">PATH</span>/TO-FIRMWARE.bin
<span class="token comment"># OR</span>
$ python3 get_vcs.py ./<span class="token environment constant">PATH</span>/TO-FIRMWARE.bin

<span class="token comment"># Pass the 'clean' flag for just VCS output (scripting)</span>
$ get_vcs.py --clean ./<span class="token environment constant">PATH</span>/TO-FIRMWARE.bin <span class="token operator">></span> something_else
</code><!-- HTML_TAG_END --></pre>
<p>This will return you the metadata in <code>JSON</code> format.</p>
<p>This library was an excellent excuse to play about with the python scripting capabilities of <code>PlatformIO</code>. Hopefully someone else finds it useful too!</p>
    <div class="nav svelte-1y8h2sy"><button class="svelte-57rnr0"><h2 class="svelte-57rnr0">PREVIOUS</h2></button>
    <a href="/index" target=""><button class="svelte-57rnr0"><h2 class="svelte-57rnr0">INDEX</h2></button></a>
    <a href="/" target=""><button class="svelte-57rnr0"><h2 class="svelte-57rnr0">HOME</h2></button></a>
    <button class="svelte-57rnr0"><h2 class="svelte-57rnr0">RANDOM</h2></button>
    
</div>
    <hr>
</article>
</main>
    <footer class="svelte-bp79tx"><div class="footer-action svelte-bp79tx"><div class="socials svelte-bp79tx">




<a href="https://www.youtube.com/channel/UCR7zc0TblvkjPy9DhAWUkvA" target="_blank" aria-label="Accessibility Label"><button  class="circle overflow-hidden svelte-eemtoe hoverable" style="background-color: #474c54" aria-label="Link to YouTube Channel"><svg height="2.2em" color="white" fill="currentColor" viewBox="0 0 512 512"><path d="M508.64 148.79c0-45-33.1-81.2-74-81.2C379.24 65 322.74 64 265 64h-18c-57.6 0-114.2 1-169.6 3.6C36.6 67.6 3.5 104 3.5 149 1 184.59-.06 220.19 0 255.79q-.15 53.4 3.4 106.9c0 45 33.1 81.5 73.9 81.5 58.2 2.7 117.9 3.9 178.6 3.8q91.2.3 178.6-3.8c40.9 0 74-36.5 74-81.5 2.4-35.7 3.5-71.3 3.4-107q.34-53.4-3.26-106.9zM207 353.89v-196.5l145 98.2z"></path></svg></button></a>




<a href="https://www.linkedin.com/in/james-bennion-pedley-bab14a146/" target="_blank" aria-label="Accessibility Label"><button  class="circle overflow-hidden svelte-eemtoe hoverable" style="background-color: #474c54" aria-label="Link to LinkedIn Page"><svg height="2.2em" color="white" fill="currentColor" viewBox="0 0 512 512"><path d="M444.17 32H70.28C49.85 32 32 46.7 32 66.89v374.72C32 461.91 49.85 480 70.28 480h373.78c20.54 0 35.94-18.21 35.94-38.39V66.89C480.12 46.7 464.6 32 444.17 32zm-273.3 373.43h-64.18V205.88h64.18zM141 175.54h-.46c-20.54 0-33.84-15.29-33.84-34.43 0-19.49 13.65-34.42 34.65-34.42s33.85 14.82 34.31 34.42c-.01 19.14-13.31 34.43-34.66 34.43zm264.43 229.89h-64.18V296.32c0-26.14-9.34-44-32.56-44-17.74 0-28.24 12-32.91 23.69-1.75 4.2-2.22 9.92-2.22 15.76v113.66h-64.18V205.88h64.18v27.77c9.34-13.3 23.93-32.44 57.88-32.44 42.13 0 74 27.77 74 87.64z"></path></svg></button></a>




<a href="https://github.com/BOJIT" target="_blank" aria-label="Accessibility Label"><button  class="circle overflow-hidden svelte-eemtoe hoverable" style="background-color: #474c54" aria-label="Link to GitHub Profile"><svg height="2.2em" color="white" fill="currentColor" viewBox="0 0 512 512"><path d="M256 32C132.3 32 32 134.9 32 261.7c0 101.5 64.2 187.5 153.2 217.9a17.56 17.56 0 0 0 3.8.4c8.3 0 11.5-6.1 11.5-11.4 0-5.5-.2-19.9-.3-39.1a102.4 102.4 0 0 1-22.6 2.7c-43.1 0-52.9-33.5-52.9-33.5-10.2-26.5-24.9-33.6-24.9-33.6-19.5-13.7-.1-14.1 1.4-14.1h.1c22.5 2 34.3 23.8 34.3 23.8 11.2 19.6 26.2 25.1 39.6 25.1a63 63 0 0 0 25.6-6c2-14.8 7.8-24.9 14.2-30.7-49.7-5.8-102-25.5-102-113.5 0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8a18.64 18.64 0 0 1 5-.5c8.1 0 26.4 3.1 56.6 24.1a208.21 208.21 0 0 1 112.2 0c30.2-21 48.5-24.1 56.6-24.1a18.64 18.64 0 0 1 5 .5c12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6 0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5 0 30.7-.3 55.5-.3 63 0 5.4 3.1 11.5 11.4 11.5a19.35 19.35 0 0 0 4-.4C415.9 449.2 480 363.1 480 261.7 480 134.9 379.7 32 256 32z"></path></svg></button></a>




<a href="https://www.facebook.com/James.BOJIT" target="_blank" aria-label="Accessibility Label"><button  class="circle overflow-hidden svelte-eemtoe hoverable" style="background-color: #474c54" aria-label="Link to Facebook Profile"><svg height="2.2em" color="white" fill="currentColor" viewBox="0 0 512 512"><path fill-rule="evenodd" d="M480 257.35c0-123.7-100.3-224-224-224s-224 100.3-224 224c0 111.8 81.9 204.47 189 221.29V322.12h-56.89v-64.77H221V208c0-56.13 33.45-87.16 84.61-87.16 24.51 0 50.15 4.38 50.15 4.38v55.13H327.5c-27.81 0-36.51 17.26-36.51 35v42h62.12l-9.92 64.77H291v156.54c107.1-16.81 189-109.48 189-221.31z"></path></svg></button></a>




<a href="https://soundcloud.com/james-bojit" target="_blank" aria-label="Accessibility Label"><button  class="circle overflow-hidden svelte-eemtoe hoverable" style="background-color: #474c54" aria-label="Link to SoundCloud Profile"><svg height="2.2em" color="white" fill="currentColor" viewBox="0 0 512 512"><path d="M5.8 278a2.11 2.11 0 0 0-2 2L0 308.64l3.74 28.16a2.12 2.12 0 0 0 2.05 2 2.14 2.14 0 0 0 2-2l4.44-28.17L7.83 280a2.14 2.14 0 0 0-2-2zm21.05-15.68a2.13 2.13 0 0 0-4.26 0l-5 46.32 5 45.3a2.13 2.13 0 0 0 4.26 0l5.73-45.31-5.73-46.32zm79.32-42.73a4 4 0 0 0-3.87 3.87l-4 85.22 4 55.08a3.88 3.88 0 0 0 7.75 0l4.53-55.08-4.53-85.22a4 4 0 0 0-3.88-3.87zm-41.05 29.62a3.09 3.09 0 0 0-3 3l-4.52 56.45 4.51 54.63a3 3 0 0 0 6 0l5.13-54.63-5.13-56.48a3.1 3.1 0 0 0-2.99-2.97zm82.76 118.39a4.83 4.83 0 0 0 4.75-4.74l3.93-54.15-3.93-113.46a4.75 4.75 0 0 0-9.5 0l-3.49 113.45 3.49 54.17a4.81 4.81 0 0 0 4.75 4.73zm85.4.25a6.6 6.6 0 0 0 6.5-6.52l2.74-52.6-2.74-131a6.5 6.5 0 1 0-13 0l-2.45 131c0 .08 2.45 52.67 2.45 52.67a6.59 6.59 0 0 0 6.5 6.45zm-43.02-.2a5.67 5.67 0 0 0 5.62-5.64l3.34-53.33-3.34-114.28a5.63 5.63 0 1 0-11.25 0l-3 114.29 3 53.32a5.66 5.66 0 0 0 5.63 5.6zm-104.7-.5a3.53 3.53 0 0 0 3.44-3.41l4.83-55.09-4.83-52.4a3.44 3.44 0 0 0-6.88 0l-4.26 52.38 4.26 55.08a3.5 3.5 0 0 0 3.44 3.44zm-40.72-3.02a2.67 2.67 0 0 0 2.57-2.52l5.43-53-5.42-55a2.57 2.57 0 0 0-5.14 0l-4.78 55 4.78 53a2.62 2.62 0 0 0 2.56 2.53zm166.85-171.6a6.1 6.1 0 0 0-6.07 6.09l-2.71 110.11 2.71 53a6.07 6.07 0 0 0 12.13 0l3-53-3-110.13a6.1 6.1 0 0 0-6.06-6.07zM127 367.71a4.41 4.41 0 0 0 4.31-4.3l4.23-54.71-4.28-104.7a4.32 4.32 0 0 0-8.63 0l-3.74 104.7 3.75 54.73a4.38 4.38 0 0 0 4.36 4.28zm47.17-5.17 3.63-53.8-3.63-117.28a5.19 5.19 0 1 0-10.37 0l-3.23 117.28 3.23 53.83a5.18 5.18 0 0 0 10.36 0zM449 241.1a62.42 62.42 0 0 0-24.33 4.9c-5-57.18-52.61-102-110.66-102a111.92 111.92 0 0 0-40.28 7.58c-4.75 1.85-6 3.76-6.06 7.46V360.4a7.66 7.66 0 0 0 6.8 7.5l174.56.11c34.78 0 63-28.41 63-63.45s-28.2-63.46-63-63.46zm-194.21-82.23a7 7 0 0 0-6.94 7L245 308.75l2.85 51.87a6.94 6.94 0 1 0 13.87-.06v.06l3.09-51.87-3.09-142.93a7 7 0 0 0-6.93-6.95z"></path></svg></button></a></div>
        <h6 class="svelte-bp79tx">© BOJIT 2022</h6></div>
    <img src="https://cdn.bojit.org/img/general/footer.JPG" alt="Page Footer" class="svelte-bp79tx">
</footer></div>
<div class="container svelte-115fuv0">
</div>


		<script type="module" data-sveltekit-hydrate="12wi86h">
		import { start } from "/_app/immutable/start-32254f0a.js";
		start({
			target: document.querySelector('[data-sveltekit-hydrate="12wi86h"]').parentNode,
			paths: {"base":"","assets":""},
			session: {},
			route: true,
			spa: false,
			trailing_slash: "never",
			hydrate: {
				status: 200,
				error: null,
				nodes: [0, 2, 5, 27],
				params: {},
				routeId: "tutorials/VCS"
			}
		});
	</script><script type="application/json" sveltekit:data-type="data" sveltekit:data-url="/posts.json">{"status":200,"statusText":"","headers":{"content-type":"application/json; charset=utf-8"},"body":"[{\"meta\":{\"title\":\"VCS (PlatformIO Advanced Scripting)\",\"date\":\"16-04-2022\",\"published\":true,\"tile\":{\"type\":\"image\",\"image\":\"/tiles/2022-04-16-VCS.PNG\"}},\"path\":\"tutorials/VCS.svelte\"},{\"meta\":{\"title\":\"SSL over a Local Network\",\"date\":\"22-08-2021\",\"published\":true,\"tile\":{\"type\":\"link\",\"colour\":\"#efa2af\"}},\"path\":\"tutorials/Local_SSL.svelte\"},{\"meta\":{\"title\":\"Compact Router Sled\",\"date\":\"03-05-2021\",\"published\":true,\"tile\":{\"type\":\"image\",\"image\":\"/tiles/2021-05-03-Router_Sled.PNG\"}},\"path\":\"projects/Router_Sled.svelte\"},{\"meta\":{\"title\":\"DIY Router Table\",\"date\":\"17-04-2021\",\"published\":true,\"tile\":{\"type\":\"image\",\"image\":\"/tiles/2021-04-17-Router_Table.PNG\"}},\"path\":\"projects/Router_Table.svelte\"},{\"meta\":{\"title\":\"PowerMac G5 Hackintosh\",\"date\":\"01-08-2020\",\"published\":true,\"tile\":{\"type\":\"image\",\"image\":\"/tiles/2020-08-01-Hackintosh.PNG\"}},\"path\":\"projects/Hackintosh.svelte\"},{\"meta\":{\"title\":\"DIY E-Drums\",\"date\":\"16-05-2020\",\"published\":true,\"tile\":{\"type\":\"image\",\"image\":\"/tiles/2020-05-16-DIY_E_Drums.PNG\"}},\"path\":\"projects/DIY_E_Drums.svelte\"},{\"meta\":{\"title\":\"BluePill MIDI Footswitch\",\"date\":\"14-05-2020\",\"published\":true,\"tile\":{\"type\":\"link\",\"colour\":\"#ffc107\"}},\"path\":\"projects/MIDI_Footswitch.svelte\"},{\"meta\":{\"title\":\"LED Hammock Room\",\"date\":\"15-02-2020\",\"published\":true,\"tile\":{\"type\":\"image\",\"image\":\"/tiles/2020-02-15-LED_Hammock_Room.JPG\"}},\"path\":\"projects/LED_Hammock_Room.svelte\"},{\"meta\":{\"title\":\"BluePill Macro Keypad\",\"date\":\"17-08-2019\",\"published\":true,\"tile\":{\"type\":\"image\",\"image\":\"/tiles/2019-08-17-Macro_Pad.PNG\"}},\"path\":\"projects/Macro_Pad.svelte\"},{\"meta\":{\"title\":\"Greenpower F24 Competition\",\"date\":\"05-06-2019\",\"published\":true,\"tile\":{\"type\":\"image\",\"image\":\"/tiles/2019-06-05-Greenpower.PNG\"}},\"path\":\"projects/Greenpower.svelte\"},{\"meta\":{\"title\":\"Touchdesigner: Image -> DMX\",\"date\":\"31-03-2019\",\"published\":true,\"tile\":{\"type\":\"link\",\"colour\":\"#87CEEB\"}},\"path\":\"tutorials/Touchdesigner_Image_DMX.svelte\"},{\"meta\":{\"title\":\"Kinect Interactive Bulb Grid\",\"date\":\"10-03-2019\",\"published\":true,\"tile\":{\"type\":\"image\",\"image\":\"/tiles/2019-03-10-Kinect_Interactive_Grid.JPG\"}},\"path\":\"projects/Kinect_Interactive_Grid.svelte\"},{\"meta\":{\"title\":\"Closed-Loop Stepper Driver\",\"date\":\"10-12-2018\",\"published\":true,\"tile\":{\"type\":\"image\",\"image\":\"/tiles/2018-12-10-Stepper_Driver.JPG\"}},\"path\":\"projects/Stepper_Driver.svelte\"},{\"meta\":{\"title\":\"Reflow Oven\",\"date\":\"10-04-2018\",\"published\":true,\"tile\":{\"type\":\"image\",\"image\":\"/tiles/2018-04-10-Reflow_Oven.PNG\"}},\"path\":\"projects/Reflow_Oven.svelte\"},{\"meta\":{\"title\":\"Artnet Node\",\"date\":\"18-02-2018\",\"published\":true,\"tile\":{\"type\":\"image\",\"image\":\"/tiles/2018-02-18-Artnet_Node.JPG\"}},\"path\":\"projects/Artnet_Node.svelte\"},{\"meta\":{\"title\":\"Custom MagicQ Wing\",\"date\":\"25-11-2017\",\"published\":true,\"tile\":{\"type\":\"image\",\"image\":\"/tiles/2017-11-25-MagicQ_Wing.PNG\"}},\"path\":\"projects/MagicQ_Wing.svelte\"},{\"meta\":{\"title\":\"DIY Electric Guitar\",\"date\":\"15-07-2017\",\"published\":true,\"tile\":{\"type\":\"image\",\"image\":\"/tiles/2017-07-15-DIY_Guitar.PNG\"}},\"path\":\"projects/DIY_Guitar.svelte\"},{\"meta\":{\"title\":\"Art Coursework\",\"date\":\"15-05-2017\",\"published\":true,\"tile\":{\"type\":\"image\",\"image\":\"/tiles/2017-05-15-Art_Coursework.JPG\"}},\"path\":\"galleries/Art_Coursework.svelte\"},{\"meta\":{\"title\":\"Pickup Winder\",\"date\":\"20-06-2016\",\"published\":true,\"tile\":{\"type\":\"image\",\"image\":\"/tiles/2016-06-20-Pickup_Winder.PNG\"}},\"path\":\"projects/Pickup_Winder.svelte\"}]"}</script>
	<script type="application/json" sveltekit:data-type="data" sveltekit:data-url="/tutorials/VCS.json">{"status":200,"statusText":"","headers":{"content-type":"application/json; charset=utf-8"},"body":"{\"title\":\"VCS (PlatformIO Advanced Scripting)\",\"date\":\"16-04-2022\",\"published\":true,\"tile\":{\"type\":\"image\",\"image\":\"/tiles/2022-04-16-VCS.PNG\"}}"}</script></div>
    </body>
</html>
